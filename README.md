# Запуск

Для запуску проекту має бути встановлений Docker, так як в ньому піднімається контейнер з базою даних.

1. Запуск контейнера з бд.

```bash
$ docker-compose up
```

2. Створення бд та мігрування.

```bash
$ npm run db:create
$ npm run db:migrate
```

3. Встановлення необхідних залежностей.

```bash
$ npm ci
```

4. Запуск сервера.

 ```bash
$ npm run start:dev
```
# Ендпоінти

## Бренди

### GET /brands/ 
Отримання всіх брендів.

**POST /brands/** - створення нового бренду, приймає боді вигляду
```bash
{
  "name": "string"
}
```
### GET /brands/:id
Отримання бренду по айді.

### PUT /brands/:id
Зміна назви бренду, приймає боді вигляду
```bash
{
  "name": "string"
}
```
### DELETE /brands/:id
Видалення бренду по айді.


## Категорії

### GET /categories/ 
Отримання всіх категорій.

### POST /categories/ 
Створення нової категорії, приймає боді вигляду
```bash
{
  "name": "string",
  "parentId": number
}
```
Поле "parentId" є опціональним і використовується для створення підкатегорії, при цьому має містити айді категорії, до якої має відноситись дана підкатегорія.

### GET /categories/:id 
Отримання категорії по айді.

### PUT /categories/:id 
Зміна назви категорії, приймає боді вигляду
```bash
{
  "name": "string"
}
```
### DELETE /categories/:id 
Видалення категорії по айді.

## Моделі

### GET /models/ 
Отримання всіх моделей.
Може приймати квері параметр **brandId** для фільтрування моделей за брендом, може приймати одне значення, або масив.

### GET /models/:id 
Отримання моделі по айді.

### PUT /models/:id 
Зміна назви моделі та бренду, приймає боді вигляду
```bash
{
  "name": "string",
  "brandId": "number"
}
```
### DELETE /models/:id
Видалення моделі по айді.

## Товари

### GET /products/ 
Отримання всіх товарів.
Може приймати квері параметри **size**, **modelId**, **brandId**, **categoryId** для фільтрування товарів за розміром, моделлю, брендом та категорією, може приймати одне значення, або масив.

### GET /products/:id 
Отримання товару по айді.

### PUT /products/:id 
Зміна назви товару, ціни, категорії та підкатегорій, приймає боді вигляду
```bash
{
  "name": "string",
  "price": number,
  "category": {
    "id":  number,
    "subcategories": [number]
}
```
**category.subcategories** має містити масив айді категорій, які є підкатегоріями основної категорії, чий айді міститься у **category.id**.

### DELETE /products/:id
Видалення товару по айді.

# Синхронізація БД з таблицею

Синхронізація бази даних з таблицею зроблена таким чином, щоб максимально зменшити необхідну кількість запитів для її виконання.
Алгоритм працює таким чином:
1. Отримання даних про моделі, їх товари та розмірів, що відносяться до цих товарів, з таблиці. Далі ці дані приводяться до тієї структури, у якій вони зберігаються в бд, а також сортуються: моделі - за назвою у зростаючому порядку, товари - за артиклем у зростаючому порядку, розміри вже є у зростаючому порядку.
2. Отримання даних про моделі, їх товари та розмірів, що відносяться до цих товарів, з бд. Отримуються з бд вони вже у відсортованому, аналогічному до сортування даних з таблиці, порядку.
3. Порівняння моделей відбувається таким чином:
   - оскільки дані з таблиці та дані з бд відсортовані у однаковому порядку, то, якщо у таблиці з'являється нова модель, наступні за алфавітом моделі зсуваються у масиві враво, а, якщо якась модель видаляється з таблиці, то настпні за алфавітом моделі зсуваються вліво
   - відбувається прохід одночасно по обох масивах - і даних з таблиці, і даних з бд
   - якщо на даній ітерації моделі з однаковим індексом з обох масивів збігаються, то відбувається звірка їх товарів та розмірів аналогічним до звірки моделей чином
   - якщо моделі не збігаються, то неможливо виявити, чи поточна модель з таблиці є новою, чи поточна модель з бд є видаленою, тому далі відбувається:
     - порівняння поточної моделі з таблиці з моделлю з голови черги видалених моделей, якщо вони збігаються, то відбувається звірка товарів та розмірів, також модель видаляється з черги видалених, оскільки була занесена туди помилково, якщо моделі не збігаються, то поточна модель з таблиці заноситься до черги нових моделей
     - аналогічним чином відбувається порівняння поточної моделі з бд з моделлю з голови черги нових моделей, якщо вони збігаються, то відбувається звірка товарів та розмірів, також модель видаляється з черги нових, оскільки була занесена туди помилково, якщо моделі не збігаються, то поточна модель з бд заноситься до черги видалених моделей
     - тому, якщо в таблиці з'являється нова модель і наступні за алфавітом моделі зсуваються вправо у масиві, то після обробки цієї нової моделі, наступні після неї існуючі в бд моделі будуть додаватись до черги нових, проте на наступній ітерації вони будуть збігатись з поточною моделлю з бд і будуть видалятись з черги нових
     - аналогічно з видаленими з таблиці моделями
   - якщо при проході не залишаються необроблені моделі з бд, але залишаються необроблені моделі з масиву моделей з таблиці і вони не збігаються з моделями з черги видалених, то вони потрапляють у чергу нових моделей
   - аналогічно, якщо залишаються тількии необроблені моделі з бд і вони не збігаються з моделями з черги нових, то потрапляють до черги видалених
4. Звірка товарів моделей та розмірів цих товарів відбувається аналогічним чином.
5. Після проведення всіх перевірок знайдені нові та видалені моделі, нові та видалені товари, нові та видалені розміри зберігаються/видаляються з бази даних.
